<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stripe Webhook Verification</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1a1a1a;
            color: #e0e0e0;
            padding: 2rem;
            line-height: 1.6;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
        h1 {
            color: #635bff;
            border-bottom: 2px solid #635bff;
            padding-bottom: 1rem;
        }
        .info-box {
            background: #2a2a2a;
            border: 1px solid #3a3a3a;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }
        .success {
            background: #1a3a1a;
            border-color: #34d399;
        }
        .warning {
            background: #3a2a1a;
            border-color: #fbbf24;
        }
        .error {
            background: #3a1a1a;
            border-color: #f87171;
        }
        h2 {
            color: #a0a0ff;
            margin-top: 2rem;
        }
        code {
            background: #3a3a3a;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            color: #34d399;
        }
        .env-var {
            background: #2a2a2a;
            border-left: 4px solid #635bff;
            padding: 1rem;
            margin: 1rem 0;
            font-family: monospace;
        }
        ul {
            margin: 1rem 0;
        }
        li {
            margin: 0.5rem 0;
        }
        .checkmark {
            color: #34d399;
        }
        .test-btn {
            background: #635bff;
            color: white;
            border: none;
            padding: 0.75rem 2rem;
            border-radius: 6px;
            font-size: 1rem;
            cursor: pointer;
            margin: 1rem 0;
        }
        .test-btn:hover {
            background: #5243ff;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }
        th, td {
            text-align: left;
            padding: 0.75rem;
            border-bottom: 1px solid #3a3a3a;
        }
        th {
            color: #a0a0ff;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚úÖ Stripe Webhook Configuration for FlightTrace</h1>
        
        <div class="info-box success">
            <h3>‚úì Webhook Endpoint Configured</h3>
            <p><strong>URL:</strong> <code>https://flightandtrace.com/api/subscription/webhooks/stripe</code></p>
            <p><strong>Status:</strong> Active</p>
            <p><strong>API Version:</strong> 2024-12-18.acacia</p>
        </div>

        <h2>üìä Your Stripe Products</h2>
        <table>
            <thead>
                <tr>
                    <th>Product</th>
                    <th>Product ID</th>
                    <th>Price ID</th>
                    <th>Amount</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>FlightTrace Premium</strong></td>
                    <td><code>prod_SvXxgTkaFMW6eD</code></td>
                    <td><code>price_1RzgrMIwUuNq64NpIeE35Py1</code></td>
                    <td>$7.99/month</td>
                </tr>
                <tr>
                    <td><strong>FlightTrace Professional</strong></td>
                    <td><code>prod_SvXyGJvJudyr84</code></td>
                    <td><code>price_1Rzgs7IwUuNq64NpjO9sQhDG</code></td>
                    <td>$24.99/month</td>
                </tr>
            </tbody>
        </table>

        <h2>üîë Required Environment Variables for Vercel</h2>
        
        <div class="env-var">
# If you have another Stripe app, use these prefixed variables:<br>
FLIGHTTRACE_STRIPE_SECRET_KEY=sk_test_...<br>
FLIGHTTRACE_STRIPE_PUBLISHABLE_KEY=pk_test_...<br>
FLIGHTTRACE_STRIPE_WEBHOOK_SECRET=whsec_...<br>
<br>
# Product Price IDs (exact values):<br>
STRIPE_PREMIUM_PRICE_ID=price_1RzgrMIwUuNq64NpIeE35Py1<br>
STRIPE_PROFESSIONAL_PRICE_ID=price_1Rzgs7IwUuNq64NpjO9sQhDG
        </div>

        <h2>üìù Webhook Events (16 Listening)</h2>
        <div class="info-box">
            <p>Your webhook is configured to listen for these events:</p>
            <ul>
                <li class="checkmark">‚úì checkout.session.completed</li>
                <li class="checkmark">‚úì customer.subscription.created</li>
                <li class="checkmark">‚úì customer.subscription.updated</li>
                <li class="checkmark">‚úì customer.subscription.deleted</li>
                <li class="checkmark">‚úì invoice.payment_succeeded</li>
                <li class="checkmark">‚úì invoice.payment_failed</li>
                <li class="checkmark">‚úì customer.updated</li>
                <li class="checkmark">‚úì payment_method.attached</li>
                <li>+ 8 more events...</li>
            </ul>
        </div>

        <h2>üß™ Test Your Integration</h2>
        
        <button class="test-btn" onclick="testWebhook()">Test Webhook Endpoint</button>
        <button class="test-btn" onclick="window.open('/test_stripe_checkout.html', '_blank')">Test Checkout Flow</button>
        
        <div id="test-result" style="display: none;" class="info-box">
            <h3>Test Result:</h3>
            <pre id="result-text"></pre>
        </div>

        <h2>üìã Integration Checklist</h2>
        <div class="info-box">
            <ul>
                <li>‚úÖ Products created in Stripe Dashboard</li>
                <li>‚úÖ Webhook endpoint configured</li>
                <li>‚úÖ Price IDs match your products</li>
                <li>‚ö†Ô∏è Add environment variables to Vercel</li>
                <li>‚ö†Ô∏è Get webhook signing secret from Stripe</li>
                <li>‚ö†Ô∏è Test with card 4242 4242 4242 4242</li>
            </ul>
        </div>

        <h2>üîç Debugging Tips</h2>
        <div class="info-box warning">
            <h3>Common Issues:</h3>
            <ul>
                <li><strong>"No such price"</strong> - Make sure the price IDs in your code match exactly</li>
                <li><strong>"Webhook signature verification failed"</strong> - Check STRIPE_WEBHOOK_SECRET is correct</li>
                <li><strong>"API key not configured"</strong> - Add FLIGHTTRACE_STRIPE_SECRET_KEY to Vercel</li>
                <li><strong>404 on webhook</strong> - The endpoint path must be exactly <code>/api/subscription/webhooks/stripe</code></li>
            </ul>
        </div>

        <h2>üì± Quick Links</h2>
        <div class="info-box">
            <ul>
                <li>üìä <a href="https://dashboard.stripe.com/products" target="_blank" style="color: #635bff;">Stripe Products</a></li>
                <li>üîó <a href="https://dashboard.stripe.com/webhooks" target="_blank" style="color: #635bff;">Stripe Webhooks</a></li>
                <li>üîë <a href="https://dashboard.stripe.com/apikeys" target="_blank" style="color: #635bff;">Stripe API Keys</a></li>
                <li>üìù <a href="https://dashboard.stripe.com/test/logs" target="_blank" style="color: #635bff;">Stripe Logs</a></li>
                <li>‚öôÔ∏è <a href="https://vercel.com/dashboard" target="_blank" style="color: #635bff;">Vercel Dashboard</a></li>
            </ul>
        </div>
    </div>

    <script>
        async function testWebhook() {
            const resultDiv = document.getElementById('test-result');
            const resultText = document.getElementById('result-text');
            
            resultDiv.style.display = 'block';
            resultText.textContent = 'Testing webhook endpoint...';
            
            try {
                const response = await fetch('https://flightandtrace.com/api/subscription/webhooks/stripe', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Stripe-Signature': 'test_signature'
                    },
                    body: JSON.stringify({
                        type: 'test',
                        data: { test: true }
                    })
                });
                
                const text = await response.text();
                
                if (response.ok) {
                    resultText.textContent = `‚úÖ Webhook endpoint is accessible!\n\nResponse: ${text}`;
                    resultDiv.className = 'info-box success';
                } else {
                    resultText.textContent = `‚ö†Ô∏è Webhook returned status ${response.status}\n\nResponse: ${text}\n\nThis is normal - the webhook expects a valid Stripe signature.`;
                    resultDiv.className = 'info-box warning';
                }
            } catch (error) {
                resultText.textContent = `‚ùå Error testing webhook:\n\n${error.message}`;
                resultDiv.className = 'info-box error';
            }
        }
    </script>
</body>
</html>